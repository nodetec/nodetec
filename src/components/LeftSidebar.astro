---
import { getCollection } from "astro:content";
import DocNavigation from "./DocNavigation.astro";
import type { ContentType } from "../content/config";

type Props = {
  currentPage: string;
};

const { currentPage } = Astro.props;

// get first part of the path
const currentDoc = currentPage.split("/")[2] as ContentType;

console.log("currentDoc", currentDoc);

const metaData = await getCollection(currentDoc, (item: { id: string }) => {
  return item.id.endsWith("index.md");
});

let folders = metaData.map((folder: any) => {
  return {
    id: folder.id.split("/").slice(0, -1).join("/"),
    label: folder.data.label,
    slug: `${folder.slug}`,
    order: folder.data.order,
  };
});

folders.sort((a, b) => a.order - b.order);

const files = await getCollection(currentDoc, (item: { id: string }) => {
  return !item.id.endsWith("index.md");
});
---

<nav class="relative mt-10 px-8 pr-3 lg:text-sm lg:leading-6">
  <ul
    class="h-full max-h-screen overflow-y-auto overflow-x-visible last:mb-24 last:pb-8"
  >
    {
      folders.map((folder: any) => (
        <DocNavigation
          folder={folder}
          currentPage={currentPage}
          files={files}
        />
      ))
    }
  </ul>
</nav>
